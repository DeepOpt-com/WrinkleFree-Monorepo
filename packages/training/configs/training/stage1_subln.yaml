# Stage 1: SubLN Insertion
# Convert pre-trained model to BitNet architecture with SubLN
stage: subln_insertion

# This stage doesn't involve training, just model conversion
# It loads a pre-trained model and inserts SubLN layers

# Output settings
output_checkpoint: stage1_model
save_format: safetensors  # or pytorch

# Training parameters (required for config resolution even though stage 1 doesn't train)
max_seq_length: 2048
batch_size: 8
gradient_accumulation_steps: 8

# Conversion settings
conversion:
  # Replace nn.Linear with BitLinear
  replace_linear: true
  # Insert SubLN before output projections
  insert_subln: true
  # Exclude certain layers from conversion (e.g., embeddings, LM head)
  exclude_layers:
    - embed_tokens
    - lm_head
  # Initialize SubLN weights
  subln_init: ones
